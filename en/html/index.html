<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="Doxygen Awesome" />
<meta property="og:image" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta property="og:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<meta property="og:url" content="https://jothepro.github.io/doxygen-awesome-css/" />
<!-- END opengraph metadata -->
<!-- BEGIN twitter metadata -->
<meta name="twitter:image:src" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta name="twitter:title" content="Doxygen Awesome" />
<meta name="twitter:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<!-- END twitter metadata -->
<title>ZeroErr: Introduction</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/svg+xml" href="logo.drawio.svg"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/sunxfancy/zeroerr" class="github-corner" title="View source on GitHub" target="_blank" rel="noopener noreferrer">
    <svg viewBox="0 0 250 250" width="40" height="40" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ZeroErr
   </div>
  </td>
 </tr>
 </tbody>
</table>
<div class="languageSwitch"><button onclick="switch_language()">ä¸­/En</button></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Introduction </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><ul><li class="level2"><a href="#autotoc_md0">Why we need another unit testing framework</a><ul><li class="level3"><a href="#autotoc_md1">1. Generic Printing</a></li>
<li class="level3"><a href="#autotoc_md2">2. Joint using of assert, log and unit testing</a></li>
<li class="level3"><a href="#autotoc_md3">3. Fuzzing Support</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md4">Features</a></li>
<li class="level2"><a href="#autotoc_md5">Header-only libraries</a></li>
</ul>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_docs_2pages_2en_21_8introduction"></a></p>
<h2><a class="anchor" id="autotoc_md0"></a>
Why we need another unit testing framework</h2>
<p>The current popular unit testing frameworks, e.g. Catch2, doctest, Boost.Test and cpputest are mature and well-established which covers common cases during development. The logger libraries like glog and spdlog are also easy to use. However, there are still some issues:</p>
<h3><a class="anchor" id="autotoc_md1"></a>
1. Generic Printing</h3>
<p>Most unit testing frameworks and logger libraries can not provide a generic printing for user customized type. Especially, when using containers, struct and pointers (including smart pointers), user have to manualy write code to generate the log message or print those information during unit testing failed cases.</p>
<p>This library <code>zeroerr</code> gives you an ability to print generically for all types:</p>
<div class="fragment"><div class="line"><a class="code hl_define" href="unittest_8h.html#aacd39763f90aeaca22dcc182ca7eb9e5">TEST_CASE</a>(<span class="stringliteral">&quot;Try logging&quot;</span>) {</div>
<div class="line">    std::vector&lt;int&gt; data = {1, 2, 3};</div>
<div class="line">    <a class="code hl_define" href="log_8h.html#a1b1ff154b2488d4ff3e067232761715a">LOG_IF</a>(1 == 1, <span class="stringliteral">&quot;data = {data}&quot;</span>, data);</div>
<div class="line">}</div>
<div class="ttc" id="alog_8h_html_a1b1ff154b2488d4ff3e067232761715a"><div class="ttname"><a href="log_8h.html#a1b1ff154b2488d4ff3e067232761715a">LOG_IF</a></div><div class="ttdeci">#define LOG_IF(cond,...)</div><div class="ttdef"><b>Definition</b> log.h:75</div></div>
<div class="ttc" id="aunittest_8h_html_aacd39763f90aeaca22dcc182ca7eb9e5"><div class="ttname"><a href="unittest_8h.html#aacd39763f90aeaca22dcc182ca7eb9e5">TEST_CASE</a></div><div class="ttdeci">#define TEST_CASE(name,...)</div><div class="ttdef"><b>Definition</b> unittest.h:18</div></div>
</div><!-- fragment --><p>Similar to other C++ unit testing frameworks, <code>zeroerr</code> will convert this piece of code into a function and register it to automatically run once you link the main function and the library. Here, we can log the data in <code>vector</code> template directly without writing any code.</p>
<p><img src="../../fig/case1.png" alt="case1" class="inline"/></p>
<p>For the custom struct type with override <code>std::ostream&amp; operator&lt;&lt;(std::ostream&amp;, Type)</code> stream output, you can use it not only for this type but also all contains using this type, including multiple recurisve contains:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Node {</div>
<div class="line">    std::string name;</div>
<div class="line">    <span class="keywordtype">int</span> id;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">std::ostream&amp; operator&lt;&lt;(std::ostream&amp; out, Node n) {</div>
<div class="line">    out &lt;&lt; n.id &lt;&lt; <span class="charliteral">&#39;.&#39;</span> &lt;&lt; n.name;</div>
<div class="line">    <span class="keywordflow">return</span> out;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="unittest_8h.html#aacd39763f90aeaca22dcc182ca7eb9e5">TEST_CASE</a>(<span class="stringliteral">&quot;Try logging with custom type&quot;</span>) {</div>
<div class="line">    std::map&lt;std::string, std::vector&lt;Node&gt;&gt; data = {</div>
<div class="line">        {<span class="stringliteral">&quot;user1&quot;</span>, {{<span class="stringliteral">&quot;a&quot;</span>,1}, {<span class="stringliteral">&quot;b&quot;</span>,2}}}, {<span class="stringliteral">&quot;user2&quot;</span>, {{<span class="stringliteral">&quot;c&quot;</span>,3}, {<span class="stringliteral">&quot;d&quot;</span>,4}}}</div>
<div class="line">    };</div>
<div class="line">    <a class="code hl_define" href="log_8h.html#a3577749fb48d57a158b8ac1a0b3ab57e">LOG</a>(<span class="stringliteral">&quot;data = {data}&quot;</span>, data);</div>
<div class="line">}</div>
<div class="ttc" id="alog_8h_html_a3577749fb48d57a158b8ac1a0b3ab57e"><div class="ttname"><a href="log_8h.html#a3577749fb48d57a158b8ac1a0b3ab57e">LOG</a></div><div class="ttdeci">#define LOG(...)</div><div class="ttdef"><b>Definition</b> log.h:58</div></div>
</div><!-- fragment --><p><img src="../../fig/case2.png" alt="case2" class="inline"/></p>
<p>Of cause, in many cases, some third-party libraries may not use <code>&lt;&lt;</code> operators. For those cases, we can write own rules to create a generic way for printing. For example, LLVM <code>llvm::Function*</code> type can not be streamed into std::ostream, we can write code to handle it. However, it will be more simple if we can write a rule for all the sub-classes of <code>llvm::Value</code> and <code>llvm::Type</code> since we can call the <code>print</code> method to print the output. Here we use a <code>dbg</code> marco defined in <code>zeroerr</code> to quickly print any type. This is very similar to the <code>dbg</code> marco in rust.</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code hl_namespace" href="namespacezeroerr.html">zeroerr</a> { <span class="comment">// must defined in namespace zeroerr</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="keyword">typename</span> std::enable_if&lt;</div>
<div class="line">    std::is_base_of&lt;llvm::Value, T&gt;::value || std::is_base_of&lt;llvm::Type, T&gt;::value, <span class="keywordtype">void</span>&gt;::type</div>
<div class="line"><a class="code hl_function" href="namespacezeroerr.html#a96f0cf094ccdf1793b38c8e6b2568a09">PrinterExt</a>(Printer&amp; P, T* s, <span class="keywordtype">unsigned</span> level, <span class="keyword">const</span> <span class="keywordtype">char</span>* lb, rank&lt;2&gt;) {</div>
<div class="line">    <span class="keywordflow">if</span> (s == <span class="keyword">nullptr</span>) {</div>
<div class="line">        P.os &lt;&lt; P.tab(level) &lt;&lt; <span class="stringliteral">&quot;nullptr&quot;</span> &lt;&lt; lb;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        llvm::raw_os_ostream os(P.os);</div>
<div class="line">        s-&gt;print(os);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line">} <span class="comment">// namespace zeroerr</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="unittest_8h.html#aacd39763f90aeaca22dcc182ca7eb9e5">TEST_CASE</a>(<span class="stringliteral">&quot;customize printing of LLVM pointers&quot;</span>) {</div>
<div class="line">    llvm::LLVMContext        context;</div>
<div class="line">    std::vector&lt;llvm::Type*&gt; args   = {llvm::Type::getInt32Ty(context)};</div>
<div class="line">    llvm::Module*            <span class="keyword">module</span> = new llvm::Module(&quot;test_module&quot;, context);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span>* f =</div>
<div class="line">        llvm::Function::Create(llvm::FunctionType::get(llvm::Type::getVoidTy(context), args, <span class="keyword">false</span>),</div>
<div class="line">                               llvm::GlobalValue::ExternalLinkage, <span class="stringliteral">&quot;test&quot;</span>, module);</div>
<div class="line">    <a class="code hl_define" href="dbg_8h.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(<a class="code hl_define" href="dbg_8h.html#aadf47595f4fdb31176441bb4415eecac">dbg</a>(f)-&gt;getType());</div>
<div class="line">}</div>
<div class="ttc" id="adbg_8h_html_aadf47595f4fdb31176441bb4415eecac"><div class="ttname"><a href="dbg_8h.html#aadf47595f4fdb31176441bb4415eecac">dbg</a></div><div class="ttdeci">#define dbg(...)</div><div class="ttdef"><b>Definition</b> dbg.h:13</div></div>
<div class="ttc" id="anamespacezeroerr_html"><div class="ttname"><a href="namespacezeroerr.html">zeroerr</a></div><div class="ttdef"><b>Definition</b> benchmark.cpp:17</div></div>
<div class="ttc" id="anamespacezeroerr_html_a96f0cf094ccdf1793b38c8e6b2568a09"><div class="ttname"><a href="namespacezeroerr.html#a96f0cf094ccdf1793b38c8e6b2568a09">zeroerr::PrinterExt</a></div><div class="ttdeci">void PrinterExt(Printer &amp;, T, unsigned, const char *, rank&lt; 0 &gt;)</div><div class="ttdoc">PrinterExt is an extension of Printer that allows user to write custom rules for printing.</div><div class="ttdef"><b>Definition</b> print.h:282</div></div>
</div><!-- fragment --><p>This functin <code>PrintExt</code> will match all the class who's base class is <code>Value</code> and <code>Type</code>. Then, it will create a stream `<code>llvm::raw_os_ostream</code> for output.</p>
<p><img src="../../fig/case3.png" alt="case3-llvm" class="inline"/></p>
<h3><a class="anchor" id="autotoc_md2"></a>
2. Joint using of assert, log and unit testing</h3>
<p>If you use a logger, an unit testing framework and a smart assert libary, you can joint use them and some macros may conflict. In <code>zeroerr</code>, if an assertion is failed, the logger will recevie an event and stored in your log file. If you are using an assertion in unit testing, the assertion can be recorded and reported in the end.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> fib(<span class="keywordtype">int</span> n) {</div>
<div class="line">    <a class="code hl_define" href="assert_8h.html#ad57835ba8f1bb419a865ada6bd011a85">REQUIRE</a>(n &gt;= 0, <span class="stringliteral">&quot;n must be non-negative&quot;</span>);</div>
<div class="line">    <a class="code hl_define" href="assert_8h.html#ad57835ba8f1bb419a865ada6bd011a85">REQUIRE</a>(n &lt; 20, <span class="stringliteral">&quot;n must be less than 20&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (n &lt;= 2) {</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> fib(n - 1) + fib(n - 2);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="unittest_8h.html#aacd39763f90aeaca22dcc182ca7eb9e5">TEST_CASE</a>(<span class="stringliteral">&quot;fib function test&quot;</span>) {</div>
<div class="line">    <a class="code hl_define" href="assert_8h.html#a836cca6b6ed3a1706353f6d1bca0935f">CHECK</a>(fib(0) == 0);</div>
<div class="line">    <a class="code hl_define" href="assert_8h.html#a836cca6b6ed3a1706353f6d1bca0935f">CHECK</a>(fib(1) == 1);</div>
<div class="line">    <a class="code hl_define" href="assert_8h.html#a836cca6b6ed3a1706353f6d1bca0935f">CHECK</a>(fib(2) == 1);</div>
<div class="line">    <a class="code hl_define" href="assert_8h.html#a836cca6b6ed3a1706353f6d1bca0935f">CHECK</a>(fib(3) == 2);</div>
<div class="line">    <a class="code hl_define" href="assert_8h.html#a836cca6b6ed3a1706353f6d1bca0935f">CHECK</a>(fib(4) == 3);</div>
<div class="line">    <a class="code hl_define" href="assert_8h.html#a836cca6b6ed3a1706353f6d1bca0935f">CHECK</a>(fib(5) == 5);</div>
<div class="line">    <a class="code hl_define" href="assert_8h.html#a836cca6b6ed3a1706353f6d1bca0935f">CHECK</a>(fib(20) == 6765);</div>
<div class="line">}</div>
<div class="ttc" id="aassert_8h_html_a836cca6b6ed3a1706353f6d1bca0935f"><div class="ttname"><a href="assert_8h.html#a836cca6b6ed3a1706353f6d1bca0935f">CHECK</a></div><div class="ttdeci">#define CHECK(...)</div><div class="ttdef"><b>Definition</b> assert.h:161</div></div>
<div class="ttc" id="aassert_8h_html_ad57835ba8f1bb419a865ada6bd011a85"><div class="ttname"><a href="assert_8h.html#ad57835ba8f1bb419a865ada6bd011a85">REQUIRE</a></div><div class="ttdeci">#define REQUIRE(...)</div><div class="ttdef"><b>Definition</b> assert.h:164</div></div>
</div><!-- fragment --><p><img src="../../fig/joint1.png" alt="joint1" class="inline"/></p>
<p>Further more, the unit testing can check the log result matches the previous running result to avoid writing code to check it.</p>
<div class="fragment"><div class="line"><a class="code hl_define" href="unittest_8h.html#aacd39763f90aeaca22dcc182ca7eb9e5">TEST_CASE</a>(<span class="stringliteral">&quot;match ostream&quot;</span>) {</div>
<div class="line">    <span class="comment">// match output can be done in the following workflow</span></div>
<div class="line">    <span class="comment">// 1. user mark the test case which are comparing output use &#39;have_same_output&#39;</span></div>
<div class="line">    <span class="comment">// 2. If the output is not exist, the result has been used as a correct verifier.</span></div>
<div class="line">    <span class="comment">// 3. If the output is exist, compare with it and report error if output is not match.</span></div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;a = 100&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="unittest_8h.html#ab67723d90c1abf342268b6e93bb7344d">ZEROERR_HAVE_SAME_OUTPUT</a>;</div>
<div class="line">}</div>
<div class="ttc" id="aunittest_8h_html_ab67723d90c1abf342268b6e93bb7344d"><div class="ttname"><a href="unittest_8h.html#ab67723d90c1abf342268b6e93bb7344d">ZEROERR_HAVE_SAME_OUTPUT</a></div><div class="ttdeci">#define ZEROERR_HAVE_SAME_OUTPUT</div><div class="ttdef"><b>Definition</b> unittest.h:43</div></div>
</div><!-- fragment --><p>Once you set <code>ZEROERR_HAVE_SAME_OUTPUT</code> marco, the system will check the output stream and save the first run result into a file. Then, the next run will compare the result to see if it the same. (Currently experimental)</p>
<p>Finally, for the log system, the unit testing can access the log data to ensure that the function has executed the expected logic and results.</p>
<div class="fragment"><div class="line">118 <span class="keyword">static</span> <span class="keywordtype">void</span> function() {</div>
<div class="line">119    <a class="code hl_define" href="log_8h.html#a3577749fb48d57a158b8ac1a0b3ab57e">LOG</a>(<span class="stringliteral">&quot;function log {i}&quot;</span>, 1);  </div>
<div class="line">120    <a class="code hl_define" href="log_8h.html#a3577749fb48d57a158b8ac1a0b3ab57e">LOG</a>(<span class="stringliteral">&quot;function log {sum}, {i}&quot;</span>, 10, 1);</div>
<div class="line">121 }</div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">TEST_CASE(<span class="stringliteral">&quot;access log in Test case&quot;</span>) {</div>
<div class="line">    <a class="code hl_function" href="namespacezeroerr.html#a15bfbcb4e56dee3848f8ae3b6099649b">zeroerr::suspendLog</a>();</div>
<div class="line">    function();</div>
<div class="line">    <a class="code hl_define" href="assert_8h.html#a836cca6b6ed3a1706353f6d1bca0935f">CHECK</a>(<a class="code hl_define" href="log_8h.html#ac022ed56eb070c881aebfecc5d4293f1">LOG_GET</a>(function, 119, i, <span class="keywordtype">int</span>) == 1);</div>
<div class="line">    <a class="code hl_define" href="assert_8h.html#a836cca6b6ed3a1706353f6d1bca0935f">CHECK</a>(<a class="code hl_define" href="log_8h.html#ac022ed56eb070c881aebfecc5d4293f1">LOG_GET</a>(function, 120, sum, <span class="keywordtype">int</span>) == 10);</div>
<div class="line">    <a class="code hl_define" href="assert_8h.html#a836cca6b6ed3a1706353f6d1bca0935f">CHECK</a>(<a class="code hl_define" href="log_8h.html#ac022ed56eb070c881aebfecc5d4293f1">LOG_GET</a>(function, 120, i, <span class="keywordtype">int</span>) == 1);</div>
<div class="line">    <a class="code hl_function" href="namespacezeroerr.html#a6b5f6bde6d7218373c3db5958458c4a2">zeroerr::resumeLog</a>();</div>
<div class="line">}</div>
<div class="ttc" id="alog_8h_html_ac022ed56eb070c881aebfecc5d4293f1"><div class="ttname"><a href="log_8h.html#ac022ed56eb070c881aebfecc5d4293f1">LOG_GET</a></div><div class="ttdeci">#define LOG_GET(func, id, name, type)</div><div class="ttdef"><b>Definition</b> log.h:64</div></div>
<div class="ttc" id="anamespacezeroerr_html_a15bfbcb4e56dee3848f8ae3b6099649b"><div class="ttname"><a href="namespacezeroerr.html#a15bfbcb4e56dee3848f8ae3b6099649b">zeroerr::suspendLog</a></div><div class="ttdeci">void suspendLog()</div><div class="ttdoc">suspend the log to flush to the file</div><div class="ttdef"><b>Definition</b> log.cpp:432</div></div>
<div class="ttc" id="anamespacezeroerr_html_a6b5f6bde6d7218373c3db5958458c4a2"><div class="ttname"><a href="namespacezeroerr.html#a6b5f6bde6d7218373c3db5958458c4a2">zeroerr::resumeLog</a></div><div class="ttdeci">void resumeLog()</div><div class="ttdoc">resume the log to flush to the file</div><div class="ttdef"><b>Definition</b> log.cpp:437</div></div>
</div><!-- fragment --><p>In order to access the log, we need to pause the log system first, to avoid the data being output to the file, then call the function, access the data in the log through the <code>LOG_GET</code> macro, and finally resume the log system. (Currently experimental, only the first call of each log point can be accessed)</p>
<h3><a class="anchor" id="autotoc_md3"></a>
3. Fuzzing Support</h3>
<p>Most Unit Testing frameworks do not support fuzzing. However, it's a powerful feature to automatically detect faults in the software and can greatly reduce the work to write test cases.</p>
<p>Different than other fuzzing framework, <code>zeroerr</code> can also support logging and assertion in the code, so the fuzzing result not only contains corpus but also with the logging and assertion information.</p>
<p>Here is an example of using <code>zeroerr</code> to do structured fuzzing:</p>
<div class="fragment"><div class="line"><a class="code hl_define" href="fuzztest_8h.html#a7f879d955e8e0866bb811f1abc099fae">FUZZ_TEST_CASE</a>(<span class="stringliteral">&quot;fuzz_test&quot;</span>) {</div>
<div class="line">    <a class="code hl_define" href="log_8h.html#a3577749fb48d57a158b8ac1a0b3ab57e">LOG</a>(<span class="stringliteral">&quot;Run fuzz_test&quot;</span>);</div>
<div class="line">    <a class="code hl_define" href="fuzztest_8h.html#a25016d0ee73771a602a07c1263076366">FUZZ_FUNC</a>([=](<span class="keywordtype">int</span> k, std::string num) {</div>
<div class="line">        <span class="keywordtype">int</span> t = atoi(num.c_str());</div>
<div class="line">        <a class="code hl_define" href="log_8h.html#a3577749fb48d57a158b8ac1a0b3ab57e">LOG</a>(<span class="stringliteral">&quot;k: {k}, num:{num}, t: {t}&quot;</span>, k, num, t);</div>
<div class="line">        <a class="code hl_define" href="assert_8h.html#ad57835ba8f1bb419a865ada6bd011a85">REQUIRE</a>(k == t);</div>
<div class="line">    })</div>
<div class="line">        .WithDomains(InRange&lt;int&gt;(0, 10), Arbitrary&lt;std::string&gt;())</div>
<div class="line">        .WithSeeds({{5, <span class="stringliteral">&quot;Foo&quot;</span>}, {10, <span class="stringliteral">&quot;Bar&quot;</span>}})</div>
<div class="line">        .Run(10);</div>
<div class="line">}</div>
<div class="ttc" id="afuzztest_8h_html_a25016d0ee73771a602a07c1263076366"><div class="ttname"><a href="fuzztest_8h.html#a25016d0ee73771a602a07c1263076366">FUZZ_FUNC</a></div><div class="ttdeci">#define FUZZ_FUNC(func)</div><div class="ttdef"><b>Definition</b> fuzztest.h:32</div></div>
<div class="ttc" id="afuzztest_8h_html_a7f879d955e8e0866bb811f1abc099fae"><div class="ttname"><a href="fuzztest_8h.html#a7f879d955e8e0866bb811f1abc099fae">FUZZ_TEST_CASE</a></div><div class="ttdeci">#define FUZZ_TEST_CASE(name,...)</div><div class="ttdef"><b>Definition</b> fuzztest.h:29</div></div>
</div><!-- fragment --><p>Inspired by <a href="https://github.com/google/fuzztest">fuzztest</a>, Domain is a concept to specify the input data range (or patterns) for the target function. Here, we use <code>InRange</code> to specify the range of <code>k</code> is 0 to 10, and <code>Arbitrary</code> to specify the data of <code>num</code> can be any random string. Then, we use <code>WithSeeds</code> to specify the initial seeds for the fuzzing.</p>
<p>The macro <code>FUZZ_TEST_CASE</code> will generate a test case which can connect with <code>libFuzzer</code> to run the fuzzing. Finally, we use <code>Run(10)</code> to call <code>libFuzzer</code> to run the target for 10 times.</p>
<p>To build the test case with fuzzing, you need to use <code>clang++</code> to compile the code and with <code>-fsanitize=fuzzer-no-link</code> and link the <code>-lclang_rt.fuzzer_no_main-x86_64</code> which is a version of libFuzzer without main function. You can find this runtime library by calling <code>clang++ -print-runtime-dir</code>. Here is the complete command to build the test case with fuzzing support:</p>
<div class="fragment"><div class="line">clang++ -std=c++11 -fsanitize=fuzzer-no-link -L=`clang++ -print-runtime-dir` -lclang_rt.fuzzer_no_main-x86_64  -o test_fuzz test_fuzz.cpp </div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md4"></a>
Features</h2>
<p>Using ZeroErr, you can catch your assert error, log fatal event in the unit testing. The fatal condition will be recorded and printed. Here are a list of features we provided:</p>
<ol type="1">
<li>Minimal Requirement You can only include what you need. If you need assert but no unit testing, no problem.</li>
<li>Optional thread safety You can choose to build with/without thread safety. For some simple single thread program, log is no need to be multithread safed.</li>
<li>Fastest log Using a lock-free queue for logging and multiple level of log writing policies. You can choose to only write to disk with the most important events.</li>
<li>Customized print / log / assert printing format You can customize your printing format for everything. There is a callback function for the printing.</li>
<li>Quickly debug something You can use dbg macro to quickly see the output, it can print the expression also.</li>
<li>Colorful output You can have default colorful output to terminal and no color for file</li>
<li>Print struct/stl/special library data structure</li>
<li>Doctest like assertion and unit test feature You can use your unit test as a documentation of function behavior. The output of unittest can be a documented report.</li>
<li>Lazy logging for assertion After assertion failed, the logging result will print automatically even if you didn't redirect to your error stream</li>
<li>Logging Category Logging information can have customized category and only display one categroy based on your assertion or configuration</li>
<li>Logging for Unit Testing You can use a correct logging result as your unit testing comparsion. So you just need to manually verify your log once and setup it as baseline comparsion. The unit testing framework will use that as the result to verify unit testing</li>
<li>Structured Logging We can support output structured information directly into plain text, json, logfmt, or other custom format</li>
<li>Automatic Tracing with logging While logging at the end, we can record the time consuming for this function.</li>
</ol>
<h2><a class="anchor" id="autotoc_md5"></a>
Header-only libraries</h2>
<ul>
<li>dbg</li>
<li>print (without use extern functions)</li>
<li>assert</li>
<li>color (if always enable) </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
