<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="Doxygen Awesome" />
<meta property="og:image" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta property="og:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<meta property="og:url" content="https://jothepro.github.io/doxygen-awesome-css/" />
<!-- END opengraph metadata -->
<!-- BEGIN twitter metadata -->
<meta name="twitter:image:src" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta name="twitter:title" content="Doxygen Awesome" />
<meta name="twitter:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<!-- END twitter metadata -->
<title>ZeroErr: Mix Assertion, Logging, Unit Testing and Fuzzing</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/svg+xml" href="logo.drawio.svg"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/sunxfancy/zeroerr" class="github-corner" title="View source on GitHub" target="_blank" rel="noopener noreferrer">
    <svg viewBox="0 0 250 250" width="40" height="40" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ZeroErr
   </div>
  </td>
 </tr>
 </tbody>
</table>
<div class="languageSwitch"><button onclick="switch_language()">ä¸­/En</button></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docs_2pages_2en_27_8mix-functions.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Mix Assertion, Logging, Unit Testing and Fuzzing</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md25">Issues in Unit Tesing</a></li>
<li class="level1"><a href="#autotoc_md26">Structure Logging</a></li>
<li class="level1"><a href="#autotoc_md27">Another problem with assertion</a></li>
<li class="level1"><a href="#autotoc_md28">Design a Smart Assertion Library</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="autotoc_md25"></a>
Issues in Unit Tesing</h1>
<p>Almost every project needs unit testing. This is most important way to build a strong software but it sometimes may be hard to check boundary cases. Let's consider an example:</p>
<div class="fragment"><div class="line">Object* create(<span class="keywordtype">int</span> param) </div>
<div class="line">{</div>
<div class="line">    Object* obj = NULL;</div>
<div class="line">    <span class="comment">// try create using method A</span></div>
<div class="line">    <span class="comment">// do sth.</span></div>
<div class="line">    obj = ...;</div>
<div class="line">    <span class="keywordflow">if</span> (obj) {</div>
<div class="line">        <span class="keywordflow">return</span> obj</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// try create using method B</span></div>
<div class="line">    <span class="comment">// do sth.</span></div>
<div class="line">    obj = ...;</div>
<div class="line">    <span class="keywordflow">if</span> (obj) {</div>
<div class="line">        <span class="keywordflow">return</span> obj;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> obj;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The function <code>create</code> try to create object using different ways, if one is failed and then try another. But how should we write test cases to check it. You didn't know this is from method A or B and the output looks the same.</p>
<p>A good news is we can add log. This is a way to know some information for the function we just ran:</p>
<div class="fragment"><div class="line">Object* create(<span class="keywordtype">int</span> param) </div>
<div class="line">{</div>
<div class="line">    Object* obj = NULL;</div>
<div class="line">    <span class="comment">// try create using method A</span></div>
<div class="line">    <span class="comment">// do sth.</span></div>
<div class="line">    obj = ...;</div>
<div class="line">    <span class="keywordflow">if</span> (obj) {</div>
<div class="line">        <a class="code hl_define" href="log_8h.html#a3577749fb48d57a158b8ac1a0b3ab57e">LOG</a>(<a class="code hl_define" href="log_8h.html#aedf01192151e10a6620567952711ff69">INFO</a>) &lt;&lt; <span class="stringliteral">&quot;create object using method A.&quot;</span>;</div>
<div class="line">        <span class="keywordflow">return</span> obj</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// try create using method B</span></div>
<div class="line">    <span class="comment">// do sth.</span></div>
<div class="line">    obj = ...;</div>
<div class="line">    <span class="keywordflow">if</span> (obj) {</div>
<div class="line">        <a class="code hl_define" href="log_8h.html#a3577749fb48d57a158b8ac1a0b3ab57e">LOG</a>(<a class="code hl_define" href="log_8h.html#aedf01192151e10a6620567952711ff69">INFO</a>) &lt;&lt; <span class="stringliteral">&quot;create object using method B.&quot;</span>;</div>
<div class="line">        <span class="keywordflow">return</span> obj;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> obj;</div>
<div class="line">}</div>
<div class="ttc" id="alog_8h_html_a3577749fb48d57a158b8ac1a0b3ab57e"><div class="ttname"><a href="log_8h.html#a3577749fb48d57a158b8ac1a0b3ab57e">LOG</a></div><div class="ttdeci">#define LOG(...)</div><div class="ttdef"><b>Definition</b> log.h:58</div></div>
<div class="ttc" id="alog_8h_html_aedf01192151e10a6620567952711ff69"><div class="ttname"><a href="log_8h.html#aedf01192151e10a6620567952711ff69">INFO</a></div><div class="ttdeci">#define INFO(...)</div><div class="ttdef"><b>Definition</b> log.h:57</div></div>
</div><!-- fragment --><p>After running the function, we can see the output to know where it came from. However, there is no way to check the log in the unit testing. Yes, maybe you could read the file and see what output it wrote to the file but it's very complicated and not realiable.</p>
<p>I am thinking, maybe we could let the log data become <b>accessable</b>.</p>
<h1><a class="anchor" id="autotoc_md26"></a>
Structure Logging</h1>
<p>Log data after lowing to string will be hard to access since you missed the structure of log. To make log accessable, a better idea is to log data into some data structures. However, there are too many different types that we want to support to log. At he same time, different log may have different length.</p>
<p>Type earse is a way to support very general information. So I tried this way.</p>
<div class="fragment"><div class="line"><a class="code hl_define" href="log_8h.html#a3577749fb48d57a158b8ac1a0b3ab57e">LOG</a>(<span class="stringliteral">&quot;Here is log, name = {name}, id = {id}&quot;</span>, name, <span class="keywordtype">id</span>);</div>
</div><!-- fragment --><p>Similar to format function, this log is structured. It has two fields 'name' and 'id'. You can access those information using those names. In its implementation, a template class is used.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span>... T&gt;</div>
<div class="line"><span class="keyword">struct </span>LogMessageImpl final : LogMessage {</div>
<div class="line">    std::tuple&lt;T...&gt; args;</div>
<div class="line">    LogMessageImpl(T... args) : LogMessage(), args(args...) {}</div>
<div class="line">    ...</div>
<div class="line">};</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md27"></a>
Another problem with assertion</h1>
<p>It may also conflict with assertion in the function.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> target(<span class="keywordtype">int</span> x)</div>
<div class="line">{</div>
<div class="line">    assert(x != 0);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="unittest_8h.html#aacd39763f90aeaca22dcc182ca7eb9e5">TEST_CASE</a>(<span class="stringliteral">&quot;A unit test case&quot;</span>)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_define" href="unittest_8h.html#a86676c0b9d1d4ca819c0e6cf36e00e64">SUB_CASE</a>(<span class="stringliteral">&quot;case1&quot;</span>) {</div>
<div class="line">        target(0);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="unittest_8h.html#a86676c0b9d1d4ca819c0e6cf36e00e64">SUB_CASE</a>(<span class="stringliteral">&quot;case2&quot;</span>) {</div>
<div class="line">        target(1);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aunittest_8h_html_a86676c0b9d1d4ca819c0e6cf36e00e64"><div class="ttname"><a href="unittest_8h.html#a86676c0b9d1d4ca819c0e6cf36e00e64">SUB_CASE</a></div><div class="ttdeci">#define SUB_CASE(name,...)</div><div class="ttdef"><b>Definition</b> unittest.h:21</div></div>
<div class="ttc" id="aunittest_8h_html_aacd39763f90aeaca22dcc182ca7eb9e5"><div class="ttname"><a href="unittest_8h.html#aacd39763f90aeaca22dcc182ca7eb9e5">TEST_CASE</a></div><div class="ttdeci">#define TEST_CASE(name,...)</div><div class="ttdef"><b>Definition</b> unittest.h:18</div></div>
</div><!-- fragment --><p>All assertions follow a simple rule - once failed, exit. This will block the following test cases execution. This tell us that assertion should be awared by the unit testing, or at least, it should throw an exception instead exit the program.</p>
<h1><a class="anchor" id="autotoc_md28"></a>
Design a Smart Assertion Library</h1>
<p>Have you even though the assertion macro is not power enough? For example, when you write an assertion, you may want to have some message to make it clear.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> compute(<span class="keywordtype">int</span> x)</div>
<div class="line">{</div>
<div class="line">    assert(x != -1  &amp;&amp; <span class="stringliteral">&quot;x can not be -1 since ...&quot;</span>);</div>
<div class="line">    assert(x &gt; 0 &amp;&amp; <span class="stringliteral">&quot;x must larger than 0 since ...&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p>However, the error message still not include what value of x could be. You may need to use a format library to create the message:</p>
<div class="fragment"><div class="line">assert(x &gt; 0 &amp;&amp; format(<span class="stringliteral">&quot;x (which is {}) must larger than 0 since ...&quot;</span>, x));</div>
</div><!-- fragment --><p>This looks not that good and is hard to print if you want to have more complicated values (e.g. vector, tuple...). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
